      <!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆí”¼ì•„ ë¦´ë ˆì´ ì‚¬íšŒì (ìµœì¢…)</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; text-align: center; background: #121212; color: white; padding: 20px; }
        .card { background: #1e1e1e; border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid #333; }
        button { padding: 12px 20px; font-size: 16px; margin: 5px; cursor: pointer; border-radius: 8px; border: none; }
        .btn-main { background: #e74c3c; color: white; width: 100%; font-size: 20px; margin-top: 20px; }
        .btn-action { background: #3498db; color: white; min-width: 100px; }
        .btn-confirm { background: #27ae60 !important; color: white; font-weight: bold; width: 100%; font-size: 18px; margin-top: 15px; display: none; }
        .btn-skip { background: #34495e; color: white; margin-top: 10px; width: 100%; display: none; }
        .btn-cancel { background: #7f8c8d; color: white; margin-top: 5px; width: 100%; }
        input { padding: 12px; border-radius: 5px; border: none; width: 85%; margin-bottom: 10px; background: #2c3e50; color: white; text-align: center; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        .dead { text-decoration: line-through; color: #7f8c8d; opacity: 0.5; }
        .selected-name { color: #f1c40f; font-weight: bold; margin: 10px 0; font-size: 18px; min-height: 25px; }
        .team-info { background: #c0392b; padding: 8px 15px; border-radius: 8px; font-size: 16px; margin-top: 10px; display: inline-block; }
        .mafia-vote-info { background: #444; border: 1px solid #e74c3c; padding: 10px; border-radius: 8px; font-size: 14px; margin: 10px 0; color: #ff7675; }
        .job-desc { font-size: 12px; color: #aaa; margin-top: 15px; line-height: 1.5; border-top: 1px solid #444; padding-top: 10px; }
        #morning-report { background: #2c3e50; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; white-space: pre-line; display: none; border: 1px solid #3498db; }
        #private-report { background: #130f40; border-radius: 10px; padding: 15px; margin: 10px 0; border: 2px solid #f1c40f; color: #f1c40f; font-weight: bold; font-size: 18px; display: none; }
        #victory-screen { background: #f1c40f; color: black; font-weight: bold; padding: 30px; border-radius: 20px; display: none; margin-top: 50px; }
        #waiting-timer { color: #f1c40f; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

<div id="setup-screen" class="card">
    <h1>ğŸ•µï¸â€â™‚ï¸ ë¦´ë ˆì´ ë§ˆí”¼ì•„ (ìµœëŒ€ 13ì¸)</h1>
    <p>ì´ë¦„ì„ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„ (4~13ëª…)</p>
    <input type="text" id="playerInput" placeholder="ì´ë¦„1,ì´ë¦„2,ì´ë¦„3,ì´ë¦„4...">
    <button class="btn-main" onclick="initGame()">ê²Œì„ ì‹œì‘</button>
</div>

<div id="game-screen" style="display:none;">
    <h2 id="phase-title">ë°¤ì´ ë˜ì—ˆìŠµë‹ˆë‹¤</h2>
    <div id="morning-report"></div>
    <div id="main-display" class="card"></div>
    <div id="private-report"></div>
    <div id="action-buttons"></div>
    
    <div id="confirm-area">
        <div id="selected-display" class="selected-name"></div>
        <button id="confirm-btn" class="btn-confirm">ëŠ¥ë ¥ ì‚¬ìš© í™•ì •</button>
    </div>

    <div id="waiting-timer"></div>

    <div id="vote-input-area" style="display:none;" class="card">
        <p>ì˜¤ëŠ˜ ì²˜í˜•í•  ì‚¬ëŒì˜ ì´ë¦„ì„ ì ìœ¼ì„¸ìš”</p>
        <input type="text" id="deadPlayerName" placeholder="ì´ë¦„ ì…ë ¥">
        <button class="btn-main" onclick="executeVote()">ì‚¬ë§ ì²˜ë¦¬</button>
        <button class="btn-cancel" onclick="cancelVote()">ì·¨ì†Œ</button>
    </div>
</div>

<div id="victory-screen">
    <h1 id="victory-msg">ìŠ¹ë¦¬!</h1>
    <p id="victory-details"></p>
    <button class="btn-main" style="background: black; color: white;" onclick="location.reload()">ìƒˆ ê²Œì„ ì‹œì‘</button>
</div>

<div id="overlay" class="overlay" style="display:none;">
    <h1 id="overlay-msg">í°ì„ ë„˜ê²¨ì£¼ì„¸ìš”</h1>
    <button class="btn-main" style="width: 200px;" onclick="revealTurn()">í™•ì¸ (ë‚˜ë§Œ ë³´ê¸°)</button>
</div>

<script>
    let players = [];
    let nightPlayers = []; 
    let mafiaVotes = {}; 
    let nightActions = {}; 
    let turnIndex = 0;
    let nightCount = 0;
    let tempTarget = null;
    let voteUsedToday = false;

    const jobDetails = {
        "ë§ˆí”¼ì•„": "ë°¤ë§ˆë‹¤ ì²˜ë‹¨í•  ëŒ€ìƒì„ ê³ ë¦…ë‹ˆë‹¤. ë™ë£Œì™€ ê°ˆë¦¬ë©´ ì§€ëª©ëœ í›„ë³´ ì¤‘ ëœë¤ ì²˜ë‹¨ë©ë‹ˆë‹¤.",
        "ê²½ì°°": "ë§¤ì¼ ë°¤ í•œ ëª…ì„ ì¡°ì‚¬í•˜ì—¬ ë§ˆí”¼ì•„ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.",
        "ì˜ì‚¬": "ë§ˆí”¼ì•„ì˜ ê³µê²©ìœ¼ë¡œë¶€í„° í•œ ëª…ì„ ë³´í˜¸í•©ë‹ˆë‹¤. (ë³¸ì¸ ê°€ëŠ¥)",
        "êµ°ì¸": "ì´ê²©ì„ í•œ ë²ˆ ë²„íŒë‹ˆë‹¤. ë²„í‹¸ ì‹œ ì•„ì¹¨ì— ê³µì§€ë©ë‹ˆë‹¤.",
        "ì—°ì¸": "ì„œë¡œì˜ ì •ì²´ë¥¼ ì••ë‹ˆë‹¤. í•œ ëª…ì´ ì£½ìœ¼ë©´ ë‹¤ë¥¸ ì—°ì¸ì´ ëŒ€ì‹  ì£½ìŠµë‹ˆë‹¤.",
        "í…ŒëŸ¬ë¦¬ìŠ¤íŠ¸": "ë°¤ì— ì§€ëª©í•œ ëŒ€ìƒì„ ì‚¬ë§ ì‹œ ê¸¸ë™ë¬´ë¡œ ì‚¼ìŠµë‹ˆë‹¤.",
        "ì˜ë§¤": "2ë°¤ì— 1ë²ˆ, ì‚¬ë§ìì˜ ì§ì—…ì„ í™•ì¸í•©ë‹ˆë‹¤.",
        "ì„±ì§ì": "ë‹¨ í•œ ë²ˆ, ì£½ì€ í”Œë ˆì´ì–´ë¥¼ ë¶€í™œì‹œí‚µë‹ˆë‹¤.",
        "ê¸°ì": "ë‹¨ í•œ ë²ˆ, ë°¤ì— ì¡°ì‚¬í•œ ì •ì²´ë¥¼ ì•„ì¹¨ì— ê³µì§€í•©ë‹ˆë‹¤.",
        "ì •ì¹˜ì¸": "íˆ¬í‘œë¡œ ì£½ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°¤ì—ëŠ” ëŠ¥ë ¥ì´ ì—†ìŠµë‹ˆë‹¤."
    };

    function initGame() {
        const rawInput = document.getElementById('playerInput').value;
        const names = rawInput.split(',').map(n => n.trim()).filter(n => n !== "");
        if (names.length < 4) return;
        
        let mafiaCount = names.length >= 10 ? 3 : (names.length >= 7 ? 2 : 1);
        let gameJobs = Array(mafiaCount).fill("ë§ˆí”¼ì•„");
        gameJobs.push("ê²½ì°°", "ì˜ì‚¬");
        
        let remainingCount = names.length - gameJobs.length;

        // 7ëª… ì´ìƒì¼ ë•Œë§Œ ì—°ì¸ ë°°ì • í™•ë¥  ë°œìƒ
        if (names.length >= 7 && remainingCount >= 2 && Math.random() > 0.4) {
            gameJobs.push("ì—°ì¸", "ì—°ì¸");
            remainingCount -= 2;
        }

        let pool = Object.keys(jobDetails).filter(j => !["ë§ˆí”¼ì•„", "ê²½ì°°", "ì˜ì‚¬", "ì—°ì¸"].includes(j)).sort(() => Math.random() - 0.5);
        for(let i=0; i<remainingCount; i++) gameJobs.push(pool[i % pool.length]);
        
        gameJobs.sort(() => Math.random() - 0.5);
        players = names.map((name, i) => ({
            name: name, job: gameJobs[i], isAlive: true,
            hasShield: gameJobs[i] === "êµ°ì¸", usedSkill: false, target: null, lastUsedNight: -1
        }));
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        startNight();
    }

    function startNight() {
        if(checkVictory()) return; 
        nightPlayers = players.filter(p => p.isAlive);
        document.getElementById('morning-report').style.display = 'none';
        document.getElementById('vote-input-area').style.display = 'none';
        document.getElementById('phase-title').innerText = `${nightCount + 1}ë²ˆì§¸ ë°¤`;
        nightCount++; turnIndex = 0; mafiaVotes = {}; voteUsedToday = false;
        nightActions = { killed: null, saved: null, report: null, revived: null };
        showOverlay(`${nightPlayers[0].name}ë‹˜ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`);
    }

    function showOverlay(msg) {
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('overlay-msg').innerText = msg;
    }

    function revealTurn() {
        document.getElementById('overlay').style.display = 'none';
        renderTurn();
    }

    function renderTurn() {
        const p = nightPlayers[turnIndex];
        const display = document.getElementById('main-display');
        const actions = document.getElementById('action-buttons');
        const confirmBtn = document.getElementById('confirm-btn');
        const selectedDisplay = document.getElementById('selected-display');
        const privateReport = document.getElementById('private-report');
        
        display.innerHTML = `<h3>${p.name}ë‹˜ [${p.job}]</h3>`;
        actions.innerHTML = "";
        privateReport.style.display = "none";
        confirmBtn.style.display = "none";
        selectedDisplay.innerText = "";
        tempTarget = null;

        // ë§ˆí”¼ì•„/ì—°ì¸ ë™ë£Œ í™•ì¸
        if (p.job === "ë§ˆí”¼ì•„") {
            const partners = players.filter(pt => pt.job === "ë§ˆí”¼ì•„" && pt.name !== p.name && pt.isAlive);
            if (partners.length > 0) {
                display.innerHTML += `<div class="team-info">ë™ë£Œ: ${partners.map(pt => pt.name).join(', ')}</div>`;
                let vLogs = [];
                partners.forEach(pt => { 
                    if (mafiaVotes[pt.name]) {
                        let status = mafiaVotes[pt.name] === "skip" ? "ì„ íƒ ë§¡ê¹€" : `â†’ [${mafiaVotes[pt.name]}]`;
                        vLogs.push(`${pt.name}: ${status}`);
                    }
                });
                if (vLogs.length > 0) display.innerHTML += `<div class="mafia-vote-info">ë™ë£Œ í˜„í™©:<br>${vLogs.join('<br>')}</div>`;
            }
        } else if (p.job === "ì—°ì¸") {
            const partners = players.filter(pt => pt.job === "ì—°ì¸" && pt.name !== p.name && pt.isAlive);
            if (partners.length > 0) display.innerHTML += `<div class="team-info">ì—°ì¸: ${partners.map(pt => pt.name).join(', ')}</div>`;
        }

        const prepareAction = (target) => {
            tempTarget = target;
            selectedDisplay.innerText = `ëŒ€ìƒ: ${target.name}`;
            confirmBtn.style.display = "block";
            confirmBtn.onclick = () => executeAction(p, target);
        };

        // ëŠ¥ë ¥ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ í•­ìƒ í™•ì¸/ë„˜ê¸°ê¸° ì¹¸ì„ ë§ˆë ¨
        if (p.job === "ë§ˆí”¼ì•„") {
            renderPlayerButtons(actions, prepareAction, true);
            let remainingMafiaInQueue = false;
            for (let i = turnIndex + 1; i < nightPlayers.length; i++) {
                if (nightPlayers[i].job === "ë§ˆí”¼ì•„") { remainingMafiaInQueue = true; break; }
            }
            if (remainingMafiaInQueue) {
                addDelayedButton(actions, "ë™ë£Œì—ê²Œ ì„ íƒ ë§¡ê¸°ê¸°", () => { mafiaVotes[p.name] = "skip"; finishTurn(); });
            }
        } else if (p.job === "ê²½ì°°") {
            renderPlayerButtons(actions, prepareAction);
            addDelayedButton(actions, "í™•ì¸ ì™„ë£Œ", finishTurn);
        } else if (p.job === "ì˜ì‚¬") {
            renderPlayerButtons(actions, prepareAction, true);
            addDelayedButton(actions, "í™•ì¸ ì™„ë£Œ", finishTurn);
        } else if (p.job === "ì˜ë§¤" && nightCount > 1 && p.lastUsedNight !== nightCount - 1) {
            renderDeadButtons(actions, prepareAction);
            addDelayedButton(actions, "ëŠ¥ë ¥ ì•„ë¼ê³  ë„˜ê¸°ê¸°", finishTurn);
        } else if (p.job === "ê¸°ì" && !p.usedSkill) {
            renderPlayerButtons(actions, prepareAction);
            addDelayedButton(actions, "ëŠ¥ë ¥ ì•„ë¼ê³  ë„˜ê¸°ê¸°", finishTurn);
        } else if (p.job === "ì„±ì§ì" && !p.usedSkill) {
            renderDeadButtons(actions, prepareAction);
            addDelayedButton(actions, "ëŠ¥ë ¥ ì•„ë¼ê³  ë„˜ê¸°ê¸°", finishTurn);
        } else if (p.job === "í…ŒëŸ¬ë¦¬ìŠ¤íŠ¸") {
            renderPlayerButtons(actions, prepareAction);
            addDelayedButton(actions, "í™•ì¸ ì™„ë£Œ", finishTurn);
        } else {
            // ëŠ¥ë ¥ ì—†ëŠ” ì§ì—…, ì£½ì€ ì—°ì¸ ë“± ëª¨ë“  ìƒí™©ì—ì„œ ë²„íŠ¼ í‘œì‹œ
            addDelayedButton(actions, "í™•ì¸ ì™„ë£Œ", finishTurn);
        }

        display.innerHTML += `<div class="job-desc">${jobDetails[p.job]}</div>`;
    }

    function addDelayedButton(area, text, callback) {
        const timerText = document.getElementById('waiting-timer');
        let sec = 3;
        timerText.innerText = `${sec}ì´ˆ í›„ í™•ì¸ ê°€ëŠ¥...`;
        
        const btn = document.createElement('button'); 
        btn.innerText = text; btn.className = "btn-skip"; 
        btn.onclick = () => { timerText.innerText = ""; callback(); };
        
        const itv = setInterval(() => {
            sec--;
            if (sec > 0) { timerText.innerText = `${sec}ì´ˆ í›„ í™•ì¸ ê°€ëŠ¥...`; }
            else { clearInterval(itv); timerText.innerText = "ì´ì œ ë²„íŠ¼ì„ ëˆ„ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."; btn.style.display = "block"; }
        }, 1000);
        area.appendChild(btn);
    }

    function executeAction(p, target) {
        const privateReport = document.getElementById('private-report');
        const actions = document.getElementById('action-buttons');
        const confirmBtn = document.getElementById('confirm-btn');
        if (p.job === "ê²½ì°°") {
            privateReport.innerHTML = `ğŸ” ê²°ê³¼: ${target.name}ë‹˜ì€ ${target.job === "ë§ˆí”¼ì•„" ? "<span style='color:red'>ë§ˆí”¼ì•„(O)</span>" : "<span style='color:white'>ë§ˆí”¼ì•„ ì•„ë‹˜(X)</span>"}`;
            privateReport.style.display = "block";
        } else if (p.job === "ì˜ë§¤") {
            privateReport.innerHTML = `ğŸ‘» ê²°ê³¼: ${target.name}ë‹˜ì€ [${target.job}]ì…ë‹ˆë‹¤.`;
            privateReport.style.display = "block";
        } else if (p.job === "ë§ˆí”¼ì•„") mafiaVotes[p.name] = target.name;
        else if (p.job === "ì˜ì‚¬") nightActions.saved = target.name;
        else if (p.job === "ê¸°ì") { nightActions.report = target; p.usedSkill = true; }
        else if (p.job === "ì„±ì§ì") { nightActions.revived = target; p.usedSkill = true; }
        else if (p.job === "í…ŒëŸ¬ë¦¬ìŠ¤íŠ¸") p.target = target.name;

        if (p.job === "ê²½ì°°" || p.job === "ì˜ë§¤") {
            actions.innerHTML = ""; confirmBtn.style.display = "none";
            addDelayedButton(actions, "í™•ì¸ ì™„ë£Œ ë° ë„˜ê¸°ê¸°", () => { privateReport.style.display = "none"; finishTurn(); });
        } else { finishTurn(); }
    }

    function renderPlayerButtons(area, callback, self = false) {
        players.filter(p => p.isAlive).forEach(p => {
            if (!self && p.name === nightPlayers[turnIndex].name) return;
            let btn = document.createElement('button'); btn.className = "btn-action"; btn.innerText = p.name;
            btn.onclick = () => callback(p); area.appendChild(btn);
        });
    }

    function renderDeadButtons(area, callback) {
        let deads = players.filter(p => !p.isAlive);
        if (deads.length === 0) { area.innerHTML = "ì‚¬ë§ì ì—†ìŒ"; }
        else { deads.forEach(p => { let b = document.createElement('button'); b.className = "btn-action"; b.innerText = p.name; b.onclick = () => callback(p); area.appendChild(b); }); }
    }

    function finishTurn() {
        document.getElementById('waiting-timer').innerText = "";
        turnIndex++;
        if (turnIndex < nightPlayers.length) showOverlay(`${nightPlayers[turnIndex].name}ë‹˜ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`);
        else processNight();
    }

    function processNight() {
        let log = "â˜€ï¸ <b>ë°¤ ì‚¬ì´ ì¼ì–´ë‚œ ì¼:</b>\n";
        let voteCounts = {};
        for (let v in mafiaVotes) { let t = mafiaVotes[v]; if (t !== "skip") voteCounts[t] = (voteCounts[t] || 0) + 1; }
        let candidates = Object.keys(voteCounts);
        let targetName = null;
        if (candidates.length > 0) {
            let maxV = Math.max(...Object.values(voteCounts));
            let winners = candidates.filter(name => voteCounts[name] === maxV);
            targetName = winners[Math.floor(Math.random() * winners.length)]; 
        }
        if (targetName) {
            let t = players.find(p => p.name === targetName);
            if (nightActions.saved === targetName) log += `- ì˜ì‚¬ê°€ ê³µê²©ìœ¼ë¡œë¶€í„° ${t.name}ë‹˜ì„ ì§€ì¼°ìŠµë‹ˆë‹¤.\n`;
            else if (t.job === "êµ°ì¸" && t.hasShield) { t.hasShield = false; log += `- [ë°©íƒ„] ${t.name}ë‹˜ì´ ê³µê²©ì„ ë²„í…¼ìŠµë‹ˆë‹¤.\n`; }
            else {
                let lover = players.find(p => p.job === "ì—°ì¸" && p.name !== t.name && p.isAlive);
                if (t.job === "ì—°ì¸" && lover) { lover.isAlive = false; log += `- ì—°ì¸ ${lover.name}ë‹˜ì´ ëŒ€ì‹  ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.\n`; }
                else { t.isAlive = false; log += `- ${t.name}ë‹˜ì´ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.\n`; if (t.job === "í…ŒëŸ¬ë¦¬ìŠ¤íŠ¸" && t.target) { let v = players.find(p => p.name === t.target); if (v && v.isAlive) { v.isAlive = false; log += `- ìí­! ${v.name}ë‹˜ ì‚¬ë§.\n`; } } }
            }
        } else log += "- ì•„ë¬´ ì¼ë„ ì—†ì—ˆìŠµë‹ˆë‹¤.\n";
        if (nightActions.revived) { nightActions.revived.isAlive = true; log += `- ì„±ì§ìê°€ ${nightActions.revived.name}ë‹˜ì„ ì‚´ë ¸ìŠµë‹ˆë‹¤.\n`; }
        if (nightActions.report) log += `- [íŠ¹ì¢…] ${nightActions.report.name}ë‹˜ì€ [${nightActions.report.job}]ì…ë‹ˆë‹¤.\n`;
        showDayScreen(log); checkVictory();
    }

    function showDayScreen(log) {
        document.getElementById('phase-title').innerText = "ë‚® ì‹œê°„";
        const report = document.getElementById('morning-report');
        if(log) { report.innerHTML = log; report.style.display = 'block'; }
        const display = document.getElementById('main-display');
        const actions = document.getElementById('action-buttons');
        document.getElementById('confirm-btn').style.display = "none";
        document.getElementById('selected-display').innerText = "";
        display.innerHTML = "<h3>ìƒì¡´ í˜„í™©</h3>";
        players.forEach(p => { display.innerHTML += `<div class="${p.isAlive ? '' : 'dead'}">${p.name} [${p.isAlive ? 'ìƒì¡´' : 'ì‚¬ë§'}]</div>`; });
        actions.innerHTML = `<button class="btn-main" onclick="confirmStartNight()">íˆ¬í‘œ ì—†ì´ ë°¤ìœ¼ë¡œ</button>`;
        if (!voteUsedToday) { actions.innerHTML += `<button class="btn-main" style="background:#8e44ad" onclick="showVoteInput()">ì²˜í˜• íˆ¬í‘œ(ì´ë¦„ ì…ë ¥)</button>`; }
    }

    function confirmStartNight() { if (confirm("íˆ¬í‘œ ì—†ì´ ë‹¤ìŒ ë°¤ìœ¼ë¡œ ë„˜ì–´ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) startNight(); }
    function showVoteInput() { 
        document.getElementById('morning-report').style.display = 'none';
        document.getElementById('action-buttons').style.display = 'none';
        document.getElementById('vote-input-area').style.display = 'block'; 
    }
    function cancelVote() { 
        document.getElementById('vote-input-area').style.display = 'none';
        document.getElementById('action-buttons').style.display = 'block';
        showDayScreen(""); 
    }
    function executeVote() {
        const inputName = document.getElementById('deadPlayerName').value.trim();
        const target = players.find(p => p.name === inputName && p.isAlive);
        if (!target) return;
        if (target.job === "ì •ì¹˜ì¸") alert("ì •ì¹˜ì¸ì€ íˆ¬í‘œë¡œ ì£½ì§€ ì•ŠìŠµë‹ˆë‹¤!");
        else {
            target.isAlive = false;
            if (target.job === "í…ŒëŸ¬ë¦¬ìŠ¤íŠ¸" && target.target) {
                let v = players.find(p => p.name === target.target);
                if (v && v.isAlive) { v.isAlive = false; alert(`ìí­ ë°œìƒ! ${v.name}ë‹˜ ì‚¬ë§.`); }
            }
        }
        voteUsedToday = true;
        document.getElementById('deadPlayerName').value = "";
        startNight();
    }

    function checkVictory() {
        const aliveMafia = players.filter(p => p.isAlive && p.job === "ë§ˆí”¼ì•„").length;
        const aliveCitizen = players.filter(p => p.isAlive && p.job !== "ë§ˆí”¼ì•„").length;
        if (aliveMafia === 0) { endGame("ì‹œë¯¼íŒ€ ìŠ¹ë¦¬!", "ëª¨ë“  ë§ˆí”¼ì•„ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤."); return true; } 
        else if (aliveMafia >= aliveCitizen) { endGame("ë§ˆí”¼ì•„ ìŠ¹ë¦¬!", "ë§ˆí”¼ì•„ê°€ ì‹œë¯¼íŒ€ê³¼ ìˆ«ìê°€ ê°™ê±°ë‚˜ ë” ë§ìŠµë‹ˆë‹¤."); return true; }
        return false;
    }

    function endGame(title, detail) {
        document.getElementById('game-screen').style.display = 'none';
        const vScreen = document.getElementById('victory-screen');
        vScreen.style.display = 'block';
        document.getElementById('victory-msg').innerText = title;
        let jobsInfo = players.map(p => `${p.name}: ${p.job} (${p.isAlive ? 'ìƒì¡´' : 'ì‚¬ë§'})`).join('<br>');
        document.getElementById('victory-details').innerHTML = `${detail}<br><br><b>[ìµœì¢… ì§ì—… ê³µê°œ]</b><br>${jobsInfo}`;
        vScreen.style.background = (title === "ë§ˆí”¼ì•„ ìŠ¹ë¦¬!") ? "#c0392b" : "#27ae60";
    }
</script>
</body>
</html>
  
